---
driver:
  name: vagrant

provisioner:
  product_name: chef
  product_version: 13

platforms:
  - name: ubuntu-14.04
  - name: ubuntu-16.04
  - name: ubuntu-18.04
  - name: debian-8
  - name: debian-9
  - name: centos-6
  - name: centos-7
  - name: amazonlinux-2

suites:
  - name: default
    run_list:
      - recipe[setup]
      - recipe[threatstack]
    provisioner:
      encrypted_data_bag_secret_key_path: test/integration/data_bags/insecure_data_bag_secret
    attributes:
      apt:
        compile_time_update: true
      threatstack:
        deploy_key: <%= ENV['TS_DEPLOY_KEY'] != nil ? ENV['TS_DEPLOY_KEY'] : nil %>
#        feature_plan: <%= ENV['TS_FEATURE_PLAN'] != nil ? ENV['TS_FEATURE_PLAN'] : 'monitor' %>
        # agent_config_args:
        #   - <%= ENV['TS_CONFIG_ARGS'] %>
        url: <%= ENV['TS_URL'] != nil ? ENV['TS_URL'] : nil %>
        version: <%= ENV['TS_PACKAGE_VERSION'] != nil ? ENV['TS_PACKAGE_VERSION'] : nil %>
        configure_agent: <%= ENV['TS_CONFIG_AGENT'] == '0' ? false : true %>
        repo:
          url: <%= ENV['TS_REPO_URL'] != nil ? ENV['TS_REPO_URL'] : nil %>
          key: <%= ENV['TS_REPO_KEY'] != nil ? ENV['TS_REPO_KEY'] : nil %>

  - name: custom
    run_list:
      - recipe[setup]
      - recipe[threatstack]
    provisioner:
      encrypted_data_bag_secret_key_path: test/integration/data_bags/insecure_data_bag_secret
    attributes:
      apt:
        compile_time_update: true
      threatstack:
        deploy_key: <%= ENV['TS_DEPLOY_KEY'] != nil ? ENV['TS_DEPLOY_KEY'] : nil %>
#        feature_plan: <%= ENV['TS_FEATURE_PLAN'] != nil ? ENV['TS_FEATURE_PLAN'] : 'monitor' %>
        # agent_config_args:
        #   - <%= ENV['TS_CONFIG_ARGS'] %>
        url: <%= ENV['TS_URL'] != nil ? ENV['TS_URL'] : nil %>
        version: <%= ENV['TS_PACKAGE_VERSION'] != nil ? ENV['TS_PACKAGE_VERSION'] : nil %>
        agent_config_args: <%= ENV['TS_CONFIG_ARGS'] != [] ? ENV['TS_CONFIG_ARGS'] : [] %>
        repo:
          url: <%= ENV['TS_REPO_URL'] != nil ? ENV['TS_REPO_URL'] : nil %>
          key: <%= ENV['TS_REPO_KEY'] != nil ? ENV['TS_REPO_KEY'] : nil %>
